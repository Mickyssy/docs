"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5192],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>c});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),d=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},p=function(e){var t=d(e.components);return n.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),h=d(a),c=r,m=h["".concat(s,".").concat(c)]||h[c]||u[c]||i;return a?n.createElement(m,o(o({ref:t},p),{},{components:a})):n.createElement(m,o({ref:t},p))}));function c(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var d=2;d<i;d++)o[d]=a[d];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},4510:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>d});var n=a(7462),r=(a(7294),a(3905));const i={sidebar_position:1},o="\ud83d\udcdf POI Radio",l={unversionedId:"graphcast/radios/poi-radio",id:"graphcast/radios/poi-radio",title:"\ud83d\udcdf POI Radio",description:"The source code for the POI Radio is available here.",source:"@site/docs/graphcast/radios/poi-radio.md",sourceDirName:"graphcast/radios",slug:"/graphcast/radios/poi-radio",permalink:"/graphcast/radios/poi-radio",draft:!1,editUrl:"https://github.com/graphops/docs/edit/main/docs/graphcast/radios/poi-radio.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"gnSidebar",previous:{title:"\ud83e\uddd1\u200d\ud83d\udcbb Radio Development",permalink:"/graphcast/sdk/radio-dev"}},s={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Getting Started",id:"getting-started",level:2},{value:"Docker",id:"docker",level:3},{value:"Using pre-built image",id:"using-pre-built-image",level:4},{value:"Steps",id:"steps",level:5},{value:"Building the image using the Dockerfile locally",id:"building-the-image-using-the-dockerfile-locally",level:4},{value:"Prerequisites",id:"prerequisites",level:5},{value:"Running the POI Radio inside a Docker container",id:"running-the-poi-radio-inside-a-docker-container",level:5},{value:"Using a pre-built binary",id:"using-a-pre-built-binary",level:3},{value:"Building POI Radio locally",id:"building-poi-radio-locally",level:3},{value:"Prerequisites",id:"prerequisites-1",level:4},{value:"Running the POI Radio natively",id:"running-the-poi-radio-natively",level:4},{value:"Configuration",id:"configuration",level:2},{value:"Testnet (Goerli)",id:"testnet-goerli",level:3},{value:"Workflow",id:"workflow",level:2}],p={toc:d};function u(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"-poi-radio"},"\ud83d\udcdf POI Radio"),(0,r.kt)("p",null,"The source code for the POI Radio is available ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/graphops/poi-radio"},"here"),"."),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"The key requirement for an Indexer to earn indexing rewards is to submit a valid Proof of Indexing (POI) promptly. The importance of valid POIs causes many Indexers to alert each other on subgraph health in community discussions. To alleviate the Indexer workload, this Radio utilized Graphcast SDK to exchange and aggregate POI along with a list of Indexer on-chain identities that can be used to trace reputations. With the pubsub pattern, the Indexer can get notified as soon as other indexers (with majority of stake) publish a POI different from the local POI."),(0,r.kt)("h2",{id:"getting-started"},"Getting Started"),(0,r.kt)("p",null,"Before you follow any of the instructions below, please make sure you have a Graphcast Operator address registered for your on-chain Indexer address."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"You can connect a Graphcast Operator address to your Indexer address (with a 1:1 relationship) using our very own ",(0,r.kt)("a",{parentName:"p",href:"https://goerli.etherscan.io/address/0xBFdA8191D1ec09bB8ADc138DAbf413d00DAfb6c8"},"Registry contract")," (on Goerli). You need to use your Indexer wallet to call the ",(0,r.kt)("inlineCode",{parentName:"p"},"setGossipOperator")," function, providing the address you wish to use as an operator.")),(0,r.kt)("h3",{id:"docker"},"Docker"),(0,r.kt)("h4",{id:"using-pre-built-image"},"Using pre-built image"),(0,r.kt)("p",null,"This is the option you should go for if you're just looking to run the POI Radio as part of your Indexing stack."),(0,r.kt)("h5",{id:"steps"},"Steps"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Pull the image")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker pull ghcr.io/graphops/poi-radio:latest\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Run the image, providing the required environment variables")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'docker run -e REGISTRY_SUBGRAPH="https://api.thegraph.com/subgraphs/name/hopeyen/gossip-registry-test" -e NETWORK_SUBGRAPH="https://gateway.testnet.thegraph.com/network" -e GRAPH_NODE_STATUS_ENDPOINT="http://host.docker.internal:8030/graphql" -e PRIVATE_KEY="your operator address private key" -e ETH_NODE="an ethereum rpc node url" ghcr.io/graphops/poi-radio\n')),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"PRIVATE_KEY")," here is for your Graphcast Operator address, which is entirely separate from your Indexer Operator address. The Graphcast Operator address is authorised using our ",(0,r.kt)("a",{parentName:"p",href:"https://goerli.etherscan.io/address/0xBFdA8191D1ec09bB8ADc138DAbf413d00DAfb6c8"},"Registry contract"),". You need to use your Indexer wallet to call the ",(0,r.kt)("inlineCode",{parentName:"p"},"setGossipOperator")," function, providing the operator address.")),(0,r.kt)("p",null,"To see the full list of environment variables you can provide, check out the ",(0,r.kt)("a",{parentName:"p",href:"#configuration"},"Configuration")," section."),(0,r.kt)("h4",{id:"building-the-image-using-the-dockerfile-locally"},"Building the image using the Dockerfile locally"),(0,r.kt)("p",null,"If you want to make any changes to the POI Radio codebase, you can use this option."),(0,r.kt)("h5",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Clone this repo and ",(0,r.kt)("inlineCode",{parentName:"li"},"cd")," into it"),(0,r.kt)("li",{parentName:"ol"},"Create a ",(0,r.kt)("inlineCode",{parentName:"li"},".env")," file that includes at least the required environment variables. To see the full list of environment variables you can provide, check out the ",(0,r.kt)("a",{parentName:"li",href:"#configuration"},"Configuration")," section.")),(0,r.kt)("h5",{id:"running-the-poi-radio-inside-a-docker-container"},"Running the POI Radio inside a Docker container"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker-compose up -d\n")),(0,r.kt)("h3",{id:"using-a-pre-built-binary"},"Using a pre-built binary"),(0,r.kt)("p",null,"We also provide pre-built binaries for Ubuntu and MacOS, which you can find in the ",(0,r.kt)("inlineCode",{parentName:"p"},"Assets")," section on each release in the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/graphops/poi-radio/releases"},"releases page")," on Github. Simply download the binary, make it executable (",(0,r.kt)("inlineCode",{parentName:"p"},"chmod a+x ./poi-radio-{TAG}-{SYSTEM}"),") and then run it (using ",(0,r.kt)("inlineCode",{parentName:"p"},"./poi-radio-{TAG}-{SYSTEM}"),")."),(0,r.kt)("h3",{id:"building-poi-radio-locally"},"Building POI Radio locally"),(0,r.kt)("p",null,"To have full control over the POI Radio code and run it directly on your machine (without Docker) you can use this option."),(0,r.kt)("h4",{id:"prerequisites-1"},"Prerequisites"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Clone this repo and ",(0,r.kt)("inlineCode",{parentName:"li"},"cd")," into it"),(0,r.kt)("li",{parentName:"ol"},"Make sure you have the following installed:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.rust-lang.org/tools/install"},"Rust")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://go.dev/doc/install"},"Go")),(0,r.kt)("li",{parentName:"ul"},"Build tools (e.g. the ",(0,r.kt)("inlineCode",{parentName:"li"},"build-essentials")," package for Debian-based Linux distributions or ",(0,r.kt)("a",{parentName:"li",href:"https://mac.install.guide/commandlinetools/index.html"},"Xcode Command Line Tools")," for MacOS)"),(0,r.kt)("li",{parentName:"ul"},"C compiler (e.g. the ",(0,r.kt)("inlineCode",{parentName:"li"},"clang")," package for Debian-based Linux distribution or ",(0,r.kt)("a",{parentName:"li",href:"https://mac.install.guide/commandlinetools/index.html"},"Xcode Command Line Tools")," for MacOS)"),(0,r.kt)("li",{parentName:"ul"},"OpenSSL (e.g. the ",(0,r.kt)("inlineCode",{parentName:"li"},"libssl-dev")," package for Debian-based Linux distribution or ",(0,r.kt)("inlineCode",{parentName:"li"},"openssl")," for MacOS)"),(0,r.kt)("li",{parentName:"ul"},"PostreSQL libraries and headers (e.g. the ",(0,r.kt)("inlineCode",{parentName:"li"},"libpq-dev")," package for Debian-based Linux distribution or ",(0,r.kt)("inlineCode",{parentName:"li"},"postgresql")," for MacOS)")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"You have ",(0,r.kt)("strong",{parentName:"li"},"Graph Node")," syncing your indexer's on-chain allocations."),(0,r.kt)("li",{parentName:"ol"},"You have created a ",(0,r.kt)("inlineCode",{parentName:"li"},".env")," file that includes at least the required environment variables. To see the full list of environment variables you can provide, check out the ",(0,r.kt)("a",{parentName:"li",href:"#configuration"},"Configuration")," section.")),(0,r.kt)("h4",{id:"running-the-poi-radio-natively"},"Running the POI Radio natively"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cargo run\n")),(0,r.kt)("h2",{id:"configuration"},"Configuration"),(0,r.kt)("h3",{id:"testnet-goerli"},"Testnet (Goerli)"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Example"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ETH_NODE")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"https://goerli.infura.io/v3/<PROJECT_ID>"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"PRIVATE_KEY")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"GRAPH_NODE_STATUS_ENDPOINT")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"http://localhost:8030/graphql"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"REGISTRY_SUBGRAPH")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"https://api.thegraph.com/subgraphs/name/hopeyen/gossip-registry-test"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"NETWORK_SUBGRAPH")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"https://gateway.testnet.thegraph.com/network"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"WAKU_HOST")," (Optional)"),(0,r.kt)("td",{parentName:"tr",align:null},"Defaults to ",(0,r.kt)("inlineCode",{parentName:"td"},"127.0.0.1"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"WAKU_PORT")," (Optional)"),(0,r.kt)("td",{parentName:"tr",align:null},"Defaults to ",(0,r.kt)("inlineCode",{parentName:"td"},"8546"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"SLACK_TOKEN")," (Optional)"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"xoxp-0123456789-0123456789-0123456789-0123456789")," (defaults to ",(0,r.kt)("inlineCode",{parentName:"td"},"None"),")")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"SLACK_WEBHOOK")," (Optional)"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"https://hooks.slack.com/services/<ID>/<ID>/<TOKEN>")," (defaults to ",(0,r.kt)("inlineCode",{parentName:"td"},"None"),")")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"LOG_LEVEL")," (Optional)"),(0,r.kt)("td",{parentName:"tr",align:null},"Defaults to ",(0,r.kt)("inlineCode",{parentName:"td"},"INFO"))))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"SLACK_TOKEN")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"SLACK_WEBHOOK")," are used for POI divergence notifications in a Slack channel."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"WAKU_HOST")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"WAKU_PORT")," specify where the Graphcast node (included in all Radios) runs. If you want to run multiple Radios, or multiple instances of the same Radio, you should run them on different ports. "),(0,r.kt)("p",null,"If you want to customize the log level, you can set ",(0,r.kt)("inlineCode",{parentName:"p"},"LOG_LEVEL")," to one of ",(0,r.kt)("inlineCode",{parentName:"p"},"ERROR"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"WARN"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"DEBUG"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"TRACE"),"."),(0,r.kt)("h2",{id:"workflow"},"Workflow"),(0,r.kt)("p",null,"Upon initiation, the Radio fetches active allocations of the Radio operator's corresponding Indexer and establishes Radio topics on each allocations identified by subgraph deployment IPFS hash. Also when started, the Radio immediately starts listening for new blocks on Ethereum. On a given interval, the Radio loops through the list and acquires the normalised POI for each deployment (using the metadata of the block that we're on) and saves those nPOIs in an in-memory map. Below we will refer to these nPOIs as ",(0,r.kt)("em",{parentName:"p"},"local")," POIs since they are the ones that we've generated."),(0,r.kt)("p",null,"At the same time, other Indexers running the Radio will start doing the same, which means that messages start propagating through the network. We handle each message and add the POI from it in another in-memory map, we can refer to these POIs as ",(0,r.kt)("em",{parentName:"p"},"remote")," POIs since these are the ones that we've received from other network participants. The messages don't come only with the POI and subgraph hash, they also include a nonce (UNIX timestamp), block number and signature. The signature is then used to derive the sender's on-chain Indexer address. It's important to note that before saving an entry to the map, the radio operator verifies through the graph network subgraph for the sender's on-chain identity and amount of tokens staked, which would be used during comparisons later on."),(0,r.kt)("p",null,"After another interval we compare our ",(0,r.kt)("em",{parentName:"p"},"local")," POIs with the ",(0,r.kt)("em",{parentName:"p"},"remote")," ones. We sort the remote ones so that for each subgraph (on each block) we can take the POI that is backed by the most on-chain stake (\u2757 This does not mean the one that is sent by the Indexer with the highest stake, but rather the one that has the most ",(0,r.kt)("strong",{parentName:"p"},"combined")," stake of all the Indexers that attested to it). After we have that top POI, we compare it with our ",(0,r.kt)("em",{parentName:"p"},"local")," POI for that subgraph at that block. Voil\xe0! We now know whether our POI matches with the current consensus on the network. If we've set up a Slack Bot integration, we will also see alerts about divergence in the designated channel."))}u.isMDXComponent=!0}}]);